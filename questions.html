<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generated Quiz - BrainBurst</title>

  <!-- Cascadia Mono font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cascadia+Mono:ital,wght@0,200..700;1,200..700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Cascadia Mono', monospace;
      background: #f5f2ff;
      color: #333;
      padding: 40px;
    }

    h1 {
      text-align: center;
      color: #6a1b9a;
    }

    .question {
      background: #fff;
      padding: 20px;
      margin: 20px auto;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 800px;
    }

    .options {
      margin-top: 10px;
      padding-left: 20px;
    }

    .download-btn {
      display: block;
      margin: 30px auto;
      padding: 12px 25px;
      font-size: 18px;
      background-color: #6a1b9a;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .download-btn:hover {
      background-color: #4a0072;
    }
  </style>
</head>
<body>
  <h1>Your AI-Generated Quiz</h1>
  <div id="quizContainer"></div>
  <button class="download-btn" onclick="downloadQuiz()">Download Quiz</button>

  <script>
    const params = new URLSearchParams(window.location.search);
    const paragraph = decodeURIComponent(params.get("text") || "");
    const type = params.get("type") || "MCQ";
    const count = parseInt(params.get("count")) || 3;
    const difficulty = params.get("difficulty") || "Medium";
    const mcqCount = parseInt(params.get("mcqcount")) || 4;

    const quizContainer = document.getElementById("quizContainer");
    let quizText = `Generated Quiz (${type} - ${difficulty})\n\n`;

    function generateMCQOptions(correct, count) {
      const distractorsPool = [
        "A random concept",
        "A historical fact",
        "A wrong assumption",
        "Opposite of the answer",
        "Popular myth",
        "Irrelevant info",
        "Partially true",
        "Simplified phrase",
        "Confusing term",
        "Outdated belief"
      ];

      const options = [correct];
      while (options.length < count) {
        const fake = distractorsPool[Math.floor(Math.random() * distractorsPool.length)];
        if (!options.includes(fake)) options.push(fake);
      }

      return options.sort(() => Math.random() - 0.5);
    }

    function generateQuestions() {
      const sentences = paragraph.match(/[^.!?]+[.!?]/g) || [paragraph];
      for (let i = 0; i < count && i < sentences.length; i++) {
        const questionText = `Q${i + 1}: What can be inferred from: "${sentences[i].trim()}"`;
        const questionDiv = document.createElement("div");
        questionDiv.className = "question";

        questionDiv.innerHTML = `<strong>${questionText}</strong>`;

        if (type === "MCQ") {
          const options = generateMCQOptions(sentences[i].trim(), mcqCount);
          const optionsHTML = options.map((opt, idx) => `<div class="options">(${String.fromCharCode(65 + idx)}) ${opt}</div>`).join("");
          questionDiv.innerHTML += optionsHTML;

          quizText += questionText + "\n" + options.map((opt, idx) => `(${String.fromCharCode(65 + idx)}) ${opt}`).join("\n") + "\n\n";
        } else if (type === "True/False") {
          const isTrue = Math.random() < 0.5;
          const statement = isTrue ? sentences[i].trim() : "This statement contradicts the passage.";
          questionDiv.innerHTML += `<div class="options">(A) True</div><div class="options">(B) False</div>`;
          quizText += `Q${i + 1}: ${statement}\n(A) True\n(B) False\n\n`;
        } else if (type === "Fill in the Blanks") {
          const words = sentences[i].trim().split(" ");
          const blankIndex = Math.floor(words.length / 2);
          const correctAnswer = words[blankIndex];
          words[blankIndex] = "______";
          const question = words.join(" ");
          questionDiv.innerHTML = `<strong>Q${i + 1}: ${question}</strong>`;
          quizText += `Q${i + 1}: ${question} (Answer: ${correctAnswer})\n\n`;
        } else if (type === "Open Ended") {
          questionDiv.innerHTML = `<strong>Q${i + 1}: Explain the meaning of: "${sentences[i].trim()}"</strong>`;
          quizText += `Q${i + 1}: Explain the meaning of: "${sentences[i].trim()}"\n\n`;
        }

        quizContainer.appendChild(questionDiv);
      }
    }

    function downloadQuiz() {
      const blob = new Blob([quizText], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "quiz.txt";
      link.click();
    }

    generateQuestions();
  </script>
</body>
</html>

